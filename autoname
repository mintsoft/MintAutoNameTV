#!/bin/bash

seriesName=""
enableNobbles=""
dontMoveDir=""
enableOverwrites=""
seriesNumber=""
episodeNumber=""
mvinteractive=""

while getopts s:S:e:hionf o
do case "$o" in
		s)	seriesName="${OPTARG}"	;;
		S)	seriesNumber="${OPTARG}"	;;
		e)	episodeNumber="${OPTARG}"	;;
		o)	enableNobbles="-o"	;;
		n)	dontMoveDir="-n"	;;
		f)	enableOverwrites="-f"	;;
		i)	mvinteractive="-i"	;;
		h|\?)
			echo -e "\n    autoname [-s 'Series Name'] [-S 'Series #'] [-e 'Episode #'] [-ifno] filename\n"
			echo -e "\t -s to specify the TV Series manually"
			echo -e "\t -S to specify the Series number manually"
			echo -e "\t -e to specify the episode number manually"
			echo -e "\t -n to only rename the file, not move its directory"
			echo -e "\t -f to enable file overwrites (mv -f)"
			echo -e "\t -i to prompt before overwriting files (mv -i)"
			echo -e "\t -o to enable manual tweaks (overrides) from config.php\n"
			echo -e "If -o is specified, the -sSe options are applied prior to looking up overrides in config.php"
			exit 1
		;;
	esac
done

# Reset $@
shift $(($OPTIND-1))

#Resolve the current path of the symlink
# if the script has been symlinked into
# /usr/bin
SCRIPT_PATH="$0";
[[ -h "${SCRIPT_PATH}" ]] && SCRIPT_PATH=`readlink "${SCRIPT_PATH}"`
SCRIPT_PATH=`dirname "${SCRIPT_PATH}"`;

for var in "$@"; do
	php "${SCRIPT_PATH}"/Version2.php -s "${seriesName}" -S "${seriesNumber}" -e "${episodeNumber}" ${enableOverwrites} ${enableNobbles} ${dontMoveDir} ${mvinteractive} "${var}"
done
